# 参数说明 - urinal_path_planner_pcd.py

## 高度裁剪参数详解

### TRIM_TOP 和 TRIM_BOTTOM

这两个参数用于从点云的**Z轴方向**裁剪不需要的部分。

```python
TRIM_TOP = 0.02      # 顶部裁剪高度（米）
TRIM_BOTTOM = 0.00   # 底部裁剪高度（米）
```

### 工作原理

假设点云的Z轴范围是 `[z_min, z_max]`：

1. **TRIM_BOTTOM**: 从底部向上裁剪
   - 新的z_min = 原z_min + TRIM_BOTTOM
   - 移除所有 z < 新z_min 的点

2. **TRIM_TOP**: 从顶部向下裁剪
   - 新的z_max = 原z_max - TRIM_TOP
   - 移除所有 z > 新z_max 的点

### 实际案例

以您的小便池点云为例：

```
原始Z范围: [-0.684, -0.147] (高度=0.537m)

设置 TRIM_TOP = 0.02:
  新Z范围: [-0.684, -0.167]
  高度变化: 0.537m → 0.517m
  裁剪掉了顶部2cm的点

设置 TRIM_TOP = 0.28:
  新Z范围: [-0.684, -0.427]
  高度变化: 0.537m → 0.257m
  裁剪掉了顶部28cm的点 (约一半高度)
```

### 如何选择合适的值？

#### 1. **查看点云边界**
运行脚本后，查看输出的边界框信息：
```
边界框: X=[0.348, 0.748], Y=[0.239, 0.634], Z=[-0.685, -0.147]
```

#### 2. **计算总高度**
```
总高度 = Z_max - Z_min = -0.147 - (-0.685) = 0.538m ≈ 53.8cm
```

#### 3. **确定裁剪量**

**场景A: 去除小便池顶部边缘（常见需求）**
- 目的：不清洁顶部边缘，只清洁内部
- 建议：`TRIM_TOP = 0.05 ~ 0.10` (5-10cm)

**场景B: 去除大部分点云，只保留底部（测试用）**
- 目的：快速测试路径算法
- 建议：`TRIM_TOP = 0.30 ~ 0.40` (30-40cm)

**场景C: 去除小便池底部水槽（避开积水区）**
- 目的：不清洁底部积水区域
- 建议：`TRIM_BOTTOM = 0.08 ~ 0.15` (8-15cm)

### 当前默认值解释

在类的默认配置中：
```python
'trim_top': 0.28,     # 默认裁剪顶部28cm
'trim_bottom': 0.00,  # 默认不裁剪底部
```

但在main()函数中被覆盖为：
```python
TRIM_TOP = 0.02       # 只裁剪顶部2cm
TRIM_BOTTOM = 0.00    # 不裁剪底部
```

### 调试技巧

运行脚本后，查看这部分输出：
```
[4/4] 高度裁剪: → 14114 点
    原始Z范围: [-0.684, -0.147] (高度=0.537m)
    裁剪参数: 底部=0.000m, 顶部=0.020m
    新Z范围: [-0.684, -0.167] (高度=0.517m)
    裁剪结果: 14443 → 14114 点
```

- 如果 `裁剪结果` 显示点数变化很小 → 增大trim值
- 如果点数减少太多（>50%）→ 减小trim值
- 如果 `新Z范围` 的高度过小 → 检查是否裁剪过度

### 推荐配置

```python
# 配置1: 保守裁剪（保留大部分点云）
TRIM_TOP = 0.02      # 2cm
TRIM_BOTTOM = 0.00   # 0cm

# 配置2: 标准裁剪（适合大多数小便池）
TRIM_TOP = 0.08      # 8cm
TRIM_BOTTOM = 0.05   # 5cm

# 配置3: 激进裁剪（只保留中间区域）
TRIM_TOP = 0.15      # 15cm
TRIM_BOTTOM = 0.10   # 10cm
```

### 示例：修改参数

在 `urinal_path_planner_pcd.py` 的 `main()` 函数中：

```python
# ========== 配置参数区域 ==========
# ...

# 预处理参数
VOXEL_SIZE = 0.005
TRIM_TOP = 0.28      # ← 修改这里！从0.02改为0.28
TRIM_BOTTOM = 0.05   # ← 修改这里！从0.00改为0.05

# ...
```

保存后重新运行：
```bash
/home/olivier/miniconda3/envs/env1/bin/python urinal_path_planner_pcd.py
```

### 验证效果

1. **查看终端输出** - 检查裁剪前后的点数和Z范围
2. **查看可视化窗口** - 灰色点云应该只显示您想要的区域
3. **查看生成的路径** - 红色路径应该覆盖裁剪后的区域

---

**总结**: trim_top参数**已经在正常工作**，当前设置为0.02米。如果需要更大的裁剪效果，请在main()函数中增加该值。
